# üö® –û—Ç—á–µ—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≤ Backend API

## üìã –°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–∞—Ç–∞:** 2025-09-29  
**API URL:** https://luxa.uz  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Health Check Endpoint** - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
   - URL: `GET /api/reports/health/`
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø
   - –û—Ç–≤–µ—Ç: `{"status": "ok", "tz": "Asia/Tashkent", "server_time": "..."}`

## ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** JWT —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -X POST https://luxa.uz/api/login/ -H "Content-Type: application/json" -d '{"username": "1", "password": "1"}'
# –û—Ç–≤–µ—Ç: {"detail": "Invalid credentials"}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** X-Bot-Token –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -H "X-Bot-Token: test_token" https://luxa.uz/api/reports/daily/
# –û—Ç–≤–µ—Ç: {"detail": "Invalid bot token"}
```

### 2. Reports Endpoints

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ reports endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `GET /api/reports/daily/` - ‚ùå 401 Unauthorized
- `GET /api/reports/range/` - ‚ùå 401 Unauthorized

### 3. Bot Token Generation

**–ü—Ä–æ–±–ª–µ–º–∞:** Endpoint –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ bot token –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
curl -X POST https://luxa.uz/api/generate_bot_token/
# –û—Ç–≤–µ—Ç: 404 Not Found
```

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ Backend

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

**–í–∞—Ä–∏–∞–Ω—Ç A: JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–æ—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ credentials
- –ò–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ credentials

**–í–∞—Ä–∏–∞–Ω—Ç B: X-Bot-Token –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoint –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ bot token
- –ò–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π bot token

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Reports Endpoints

–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoints —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

```python
# GET /api/reports/daily/
{
  "date": "2025-09-28",
  "total_added": 53,
  "total_approved": 41,
  "total_rejected": 12,
  "top_regions": [...],
  "top_districts": [...],
  "top_users": [...]
}

# GET /api/reports/range/
{
  "date_from": "2025-09-10",
  "date_to": "2025-09-18",
  "total_added": 412,
  "total_approved": 351,
  "total_rejected": 61,
  "top_regions": [...],
  "top_districts": [...],
  "top_users": [...]
}
```

### 3. –î–æ–±–∞–≤–∏—Ç—å Bot Token Generation

```python
# POST /api/generate_bot_token/
# –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å:
{
  "bot_token": "bot_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "expires_at": null  # –∏–ª–∏ –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
}
```

## üß™ –¢–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ)

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **mock –¥–∞–Ω–Ω—ã–µ** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# –í api.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ
return {
    "date": "today",
    "total_added": 15,
    "total_approved": 12,
    "total_rejected": 3,
    "top_regions": [...],
    "top_districts": [...],
    "top_users": [...]
}
```

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è Backend Dev

1. **–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–æ—Ç–∞:**
   - Username: `bot_user`
   - Password: `secure_password`
   - –ò–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ credentials

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Reports API:**
   - `GET /api/reports/daily/` - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á–µ—Ç
   - `GET /api/reports/range/` - –æ—Ç—á–µ—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥
   - `GET /api/reports/health/` - —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:**
   - –õ–∏–±–æ JWT (–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å credentials)
   - –õ–∏–±–æ X-Bot-Token (—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é)

4. **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üöÄ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –û–±–Ω–æ–≤–∏—Ç—å `.env` —Ñ–∞–π–ª —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ credentials
2. –£–±—Ä–∞—Ç—å mock –¥–∞–Ω–Ω—ã–µ –∏–∑ `api.py`
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ API endpoints
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **Frontend/Bot:** –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- **Backend:** –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- **–°—Ç–∞—Ç—É—Å:** –û–∂–∏–¥–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ backend
